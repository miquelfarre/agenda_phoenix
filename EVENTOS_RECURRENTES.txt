================================================================================
GESTI√ìN DE EVENTOS RECURRENTES - ESTADO ACTUAL
================================================================================
Fecha: 2025-11-12

================================================================================
1. RESUMEN EJECUTIVO
================================================================================

Estado: ‚ö†Ô∏è  FUNCIONALIDAD PARCIALMENTE IMPLEMENTADA

Backend:  ‚úÖ COMPLETAMENTE IMPLEMENTADO
Flutter:  ‚ùå NO IMPLEMENTADO (preparado pero sin usar)

Conclusi√≥n: La infraestructura para eventos recurrentes existe en el backend
pero NO se est√° utilizando desde la aplicaci√≥n Flutter.

================================================================================
2. ARQUITECTURA DEL BACKEND
================================================================================

üìä TABLA DE BASE DE DATOS: recurring_event_configs

Ubicaci√≥n: backend/models.py l√≠nea ~XXX
Esquema:
  - id: INTEGER (primary key)
  - event_id: INTEGER (FK to events.id, UNIQUE)
  - recurrence_type: STRING(20) - 'daily', 'weekly', 'monthly', 'yearly'
  - schedule: JSON - Configuraci√≥n espec√≠fica del tipo
  - recurrence_end_date: DATETIME (nullable) - NULL = perpetuo
  - created_at: DATETIME
  - updated_at: DATETIME

Caracter√≠sticas:
  ‚úÖ Soporta 4 tipos de recurrencia
  ‚úÖ Configuraci√≥n flexible con JSON
  ‚úÖ Eventos perpetuos (sin fecha fin)
  ‚úÖ Un config por evento (unique constraint)

---

üåê ENDPOINTS DISPONIBLES (backend/routers/recurring_configs.py)

1. GET /api/v1/recurring_configs
   - Lista configs con filtros y paginaci√≥n
   - Params: event_id, limit, offset, order_by, order_dir
   - Response: List[RecurringEventConfigResponse]

2. GET /api/v1/recurring_configs/{config_id}
   - Obtiene un config espec√≠fico
   - Response: RecurringEventConfigResponse

3. POST /api/v1/recurring_configs
   - Crea nueva configuraci√≥n
   - Body: RecurringEventConfigCreate
   - Validaci√≥n en CRUD layer
   - Response: RecurringEventConfigResponse (201)

4. PUT /api/v1/recurring_configs/{config_id}
   - Actualiza config existente
   - Requiere autenticaci√≥n JWT
   - Solo owner o admins del evento
   - Response: RecurringEventConfigResponse

5. DELETE /api/v1/recurring_configs/{config_id}
   - Elimina config
   - Requiere autenticaci√≥n JWT
   - Solo owner o admins del evento
   - Response: {"message": "...", "id": X}

Estado: ‚úÖ TODOS FUNCIONANDO EN BACKEND

---

üìù SCHEMAS (backend/schemas.py)

- RecurringEventConfigBase: Campos base
- RecurringEventConfigCreate: Para creaci√≥n
- RecurringEventConfigResponse: Para respuestas

Estado: ‚úÖ DEFINIDOS Y EN USO

================================================================================
3. ESTADO EN FLUTTER
================================================================================

üì± MODELO DE DOMINIO: RecurringEventConfig

Ubicaci√≥n: lib/models/domain/recurring_event_config.dart
Estado: ‚ö†Ô∏è  EXISTE PERO NO SE USA

Campos:
  - id, eventId, recurrenceType
  - schedule (Map<String, dynamic>)
  - recurrenceEndDate
  - createdAt, updatedAt

M√©todos:
  ‚úÖ fromJson() - parsea desde API
  ‚úÖ toJson() - serializa a API
  ‚úÖ isPerpetual getter

Referencias en c√≥digo: 0 ‚ùå
Usado en repositories: NO ‚ùå
Usado en services: NO ‚ùå
Usado en UI: NO ‚ùå

---

üîå API CLIENT: M√©todos ELIMINADOS en este refactor

Los siguientes m√©todos fueron eliminados de api_client.dart:

‚ùå fetchRecurringConfig(configId)
   - GET /api/v1/recurring_configs/{config_id}

‚ùå createRecurringConfig(data)
   - POST /api/v1/recurring_configs

‚ùå updateRecurringConfig(configId, data)
   - PUT /api/v1/recurring_configs/{config_id}

‚ùå deleteRecurringConfig(configId)
   - DELETE /api/v1/recurring_configs/{config_id}

Raz√≥n: NO estaban siendo usados por ning√∫n repository o service.

---

üì¶ MODELO EVENT: Campos relacionados

Ubicaci√≥n: lib/models/domain/event.dart

Campos para recurrencia:
  ‚úÖ eventType: String - puede ser 'regular' o 'recurring'
  ‚úÖ parentRecurringEventId: int? - FK al evento padre
  ‚úÖ isRecurring: bool getter - verifica si eventType == 'recurring'

Estado: ‚úÖ PRESENTES pero NO SE USAN activamente

================================================================================
4. TIPOS DE RECURRENCIA SOPORTADOS
================================================================================

El backend soporta 4 tipos (seg√∫n documentaci√≥n del modelo):

1. 'daily' - Repetir cada d√≠a o cada X d√≠as
   Configuraci√≥n en schedule JSON

2. 'weekly' - Repetir en d√≠as espec√≠ficos de la semana
   Ejemplo: Lunes, Mi√©rcoles, Viernes
   Configuraci√≥n en schedule JSON

3. 'monthly' - Repetir en d√≠as espec√≠ficos del mes
   Ejemplo: d√≠a 1, d√≠a 15, √∫ltimo d√≠a
   Configuraci√≥n en schedule JSON

4. 'yearly' - Repetir en fecha espec√≠fica cada a√±o
   Ejemplo: Cumplea√±os, festividades
   Configuraci√≥n en schedule JSON

Eventos perpetuos:
  - Si recurrence_end_date es NULL ‚Üí repite indefinidamente
  - Com√∫n para cumplea√±os, festividades anuales

================================================================================
5. C√ìMO SE GESTIONAN ACTUALMENTE
================================================================================

Backend:
  ‚úÖ Tabla exists en DB
  ‚úÖ Endpoints implementados y funcionando
  ‚úÖ CRUD operations disponibles
  ‚úÖ Validaciones y permisos implementados
  ‚úÖ Relaci√≥n con tabla events

Flutter:
  ‚ùå NO hay UI para crear configs recurrentes
  ‚ùå NO hay repository para manejar recurring_configs
  ‚ùå NO hay service para gestionar recurrencia
  ‚ùå Modelo existe pero sin uso
  ‚ùå API client methods eliminados (por no uso)

Eventos con eventType='recurring':
  ‚ö†Ô∏è  Los eventos pueden tener eventType='recurring'
  ‚ö†Ô∏è  Pueden tener parentRecurringEventId
  ‚ö†Ô∏è  Pero no hay l√≥gica Flutter que use estos campos

================================================================================
6. FLUJO TE√ìRICO (SI SE IMPLEMENTARA)
================================================================================

1. Usuario crea un evento recurrente:
   ‚Üì
2. Flutter env√≠a POST /events con eventType='recurring'
   ‚Üì
3. Backend crea evento padre con type='recurring'
   ‚Üì
4. Flutter env√≠a POST /recurring_configs con:
   - event_id del evento creado
   - recurrence_type ('weekly', etc.)
   - schedule (JSON con config)
   - recurrence_end_date (opcional)
   ‚Üì
5. Backend guarda configuraci√≥n
   ‚Üì
6. Backend genera eventos hijos autom√°ticamente
   - Cada hijo tiene parent_recurring_event_id
   - Cada hijo tiene eventType='regular'
   - Se generan seg√∫n schedule
   ‚Üì
7. Flutter fetchea eventos normalmente
   - Obtiene eventos padre E hijos
   - Puede mostrarlos en calendario

PERO: Este flujo NO est√° implementado en Flutter actualmente.

================================================================================
7. ¬øPOR QU√â SE ELIMINARON LOS M√âTODOS?
================================================================================

Durante el refactor de reconciliaci√≥n de endpoints se encontr√≥:

‚úÖ Backend tiene 5 endpoints de recurring_configs
‚úÖ API Testing documentaba estos 5 endpoints
‚ùå Flutter ten√≠a 4 m√©todos en api_client
‚ùå Repositories NO usaban ninguno de estos m√©todos
‚ùå Services NO usaban ninguno de estos m√©todos
‚ùå UI NO llamaba a ninguno de estos m√©todos

Conclusi√≥n: Era c√≥digo muerto en Flutter.
Decisi√≥n: Eliminar m√©todos no usados del api_client.

================================================================================
8. IMPACTO DE LA ELIMINACI√ìN
================================================================================

C√≥digo eliminado:
  ‚ùå fetchRecurringConfig()
  ‚ùå createRecurringConfig()
  ‚ùå updateRecurringConfig()
  ‚ùå deleteRecurringConfig()
  ‚ùå 27 archivos de eventypop_api_testing relacionados

Funcionalidad perdida:
  ‚ö†Ô∏è  NINGUNA - no se estaba usando

Funcionalidad que sigue existiendo:
  ‚úÖ Endpoints del backend siguen funcionando
  ‚úÖ Tabla de DB sigue existiendo
  ‚úÖ Modelo Flutter sigue existiendo
  ‚úÖ Campos en Event siguen existiendo

Impacto real:
  üìä Limpieza de c√≥digo muerto en Flutter
  üìä Backend no afectado
  üìä Funcionalidad puede implementarse en el futuro

================================================================================
9. PARA IMPLEMENTAR EVENTOS RECURRENTES EN FLUTTER
================================================================================

Pasos necesarios:

1. ‚úÖ Backend - YA HECHO
   - Tabla exists
   - Endpoints funcionando
   - CRUD completo

2. ‚ùå Flutter - API Client
   ‚ñ° Restaurar m√©todos en api_client.dart:
     - fetchRecurringConfigs(eventId?)
     - fetchRecurringConfig(configId)
     - createRecurringConfig(data)
     - updateRecurringConfig(configId, data)
     - deleteRecurringConfig(configId)

3. ‚ùå Flutter - Repository
   ‚ñ° Crear RecurringConfigRepository
   ‚ñ° Implementar CRUD operations
   ‚ñ° Cache si necesario

4. ‚ùå Flutter - UI
   ‚ñ° Pantalla para crear evento recurrente
   ‚ñ° Selector de tipo de recurrencia
   ‚ñ° Configurador de schedule
   ‚ñ° Selector de fecha fin (opcional)
   ‚ñ° Vista de eventos recurrentes en calendario

5. ‚ùå Flutter - L√≥gica
   ‚ñ° Vincular eventos padre con hijos
   ‚ñ° Mostrar series de eventos
   ‚ñ° Editar serie vs instancia √∫nica
   ‚ñ° Eliminar serie vs instancia √∫nica

Esfuerzo estimado: MEDIO-ALTO (2-4 semanas)

================================================================================
10. RECOMENDACI√ìN
================================================================================

ESTADO ACTUAL: ‚úÖ CORRECTO

El refactor que se hizo fue acertado:
  ‚úÖ Se elimin√≥ c√≥digo muerto de Flutter
  ‚úÖ Se mantuvo la infraestructura del backend
  ‚úÖ Se puede implementar en el futuro sin problemas
  ‚úÖ El modelo RecurringEventConfig puede eliminarse (por ahora)

PR√ìXIMOS PASOS:

SI quieres eventos recurrentes:
  1. Restaurar modelo RecurringEventConfig
  2. A√±adir m√©todos al api_client
  3. Crear repository
  4. Implementar UI

SI NO quieres eventos recurrentes (por ahora):
  1. Eliminar RecurringEventConfig model
  2. Dejar backend como est√° (funciona independientemente)
  3. Implementar cuando sea necesario

================================================================================
FIN DEL DOCUMENTO
================================================================================
